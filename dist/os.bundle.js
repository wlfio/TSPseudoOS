!function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(r,i,function(e){return t[e]}.bind(null,i));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e,s){"use strict";s.d(e,"a",(function(){return v}));const r=t=>"/"+t.split("/").reduce((t,e)=>e.length>0&&"."!==e?".."===e?t.slice(0,t.length-1):[...t,e]:t,[]).join("/"),i=t=>0!==t.indexOf("FSF:")?"FSF:"+r(t):t,o=t=>0!==t.indexOf("FSD:")?"FSD:"+r(t):t,n=t=>0!==t.indexOf("FSP:")?"FSP:"+r(t):t,a=t=>0!==t.indexOf("FSO:")?"FSO:"+r(t):t,l=t=>(t=>localStorage.getItem(a(t))||"nobody:nobody")(t).split(":"),c=t=>l(t)[0],h=t=>parseInt(localStorage.getItem(n(t))||"",16),u=t=>{let e="";return e+=4&t?"r":"-",e+=2&t?"w":"-",e+=1&t?"x":"-"},p=t=>u(t>>8)+u(t>>4)+u(t>>0),d=t=>h(t)>>8,m=t=>h(t)>>4,g=t=>h(t)>>0,P=(t,e,s)=>{return!!(s.groups.includes((t=>l(t)[1])(t))&&m(t)&e)},y=(t,e,s)=>((t,e,s)=>{const r=s.user;return s.priveledged?!(1&e)||(1&d(t)||1&m(t)||1&g(t)):!!(r===c(t)&&d(t)&e)})(t,e,s)||P(t,e,s)||((t,e)=>!!(g(t)&e))(t,e),f=t=>t.split("/").pop()||"",S=t=>{const e=f(t).split(".");return e.length>1&&e.pop()||""},_=t=>((t.length<1||"/"===t)&&(t="/"),"___dir___"===localStorage.getItem(o(t))),v=t=>{M("/",t)},w=t=>{if(!_(t))throw console.trace(),new Error(["Access Error","Path is not directory",t].join(" : "))},E=t=>{const e=t.split("/");return t=e.slice(0,e.length-1).join("/")},O=(t,e,s)=>{if(!y(t,e,s))throw new Error(["Permissions Error","Denied "+u(e),t].join(" : "))},b=(t,e,s)=>O(E(t),e,s),D=t=>{if(!_(t))throw new Error(["Access Error","Cannot access '"+t+"': No such file or directory",t].join(" : "))},I=t=>null!==localStorage.getItem(i(t)),C=t=>{if(!I(t))throw new Error(["Access Error","Cannot access '"+t+"': No such file",t].join(" : "))},A=(t,e)=>(e=(t=>("/"!==t.charAt(0)&&(t="/"+t),"/"!==t.charAt(t.length-1)&&(t+="/"),t))(e||"/"),"/"!==(t=t.trim()).charAt(0)&&(t=e+t),t=r(t)),k=(t,e,s)=>(s=!1!==s,"~"===(t=t.trim()).charAt(0)&&(t=t.replace("~","/home/"+e.user+"/")),t=A(t,e.workingDir),s&&((t,e)=>{const s=(t=E(t)).split("/");for(let t=2;t<=s.length;t++){const r=s.slice(0,t).join("/");w(r),O(r,1,e)}})(t,e),t),x=(t,e,s,r)=>{let i=0;i|=e<<8,i|=s<<4,i|=r<<0,localStorage.setItem(n(t),"0x"+i.toString(16))},F=(t,e,s,r)=>{localStorage.setItem(a(t),[s||e.user,r||e.user].join(":"))},M=(t,e)=>!_(t)&&(localStorage.setItem(o(t),"___dir___"),x(t,7,5,5),F(t,e),!0),T=(t,e,s)=>{const r=s.getIdentity();try{t=k(t,r);const s=I(t);return s?O(t,2,r):b(t,2,r),Promise.resolve(((t,e,s,r)=>(s=!0===s,localStorage.setItem(i(t),e),s||(x(t,6,4,4),F(t,r)),[t,e]))(t,e,s,r))}catch(t){return Promise.reject(t)}},R=t=>localStorage.getItem(i(t)),j=(t,e)=>{const s=e.getIdentity();try{return t=k(t,s),C(t),O(t,4,s),Promise.resolve(R(t))}catch(t){return Promise.reject(t)}},L=(t,e)=>{const s=e.getIdentity();try{const e=((t,e)=>[k(t,e),...e.getEnv("path","/bin").split(";").map(e=>A(t,e))])(t=(t=>t.replace(/\//g,""))(t),s);for(let t=0;t<e.length;t++){const r=e[t];if(I(r)&&y(r,1,s))return Promise.resolve(r)}throw new Error(["FS Error",t,"Not found"].join(" : "))}catch(t){return Promise.reject(t)}};e.b={read:j,write:T,del:(t,e)=>{const s=e.getIdentity();try{return t=k(t,s),b(t,2,s),C(t),Promise.resolve((t=>(localStorage.removeItem(i(t)),localStorage.removeItem(n(t)),localStorage.removeItem(a(t)),t))(t))}catch(t){return Promise.reject(t)}},delDir:(t,e)=>{const s=e.getIdentity();try{return t=k(t,s),b(t,2,s),D(t),Promise.resolve((t=>{Object.keys(localStorage).forEach(e=>{e.slice(4).startsWith(t)&&localStorage.removeItem(e)})})(t))}catch(t){return Promise.reject(t)}},list:(t,e)=>{const s=e.getIdentity();try{t=k(t,s),D(t),O(t,4,s);const e=(t=>{const e=i(t)+"/",s=o(t)+"/",r=t.split("/").length;return Object.keys(localStorage).filter(t=>t.startsWith(e)||t.startsWith(s)).filter(t=>t.split("/").length<=r+1).map(t=>{const e=t.split(":");return{file:"FSF"===e[0],path:e[1]}})})(t).map(t=>(t=>{const e=!t.file,s=t.path,r=l(s),i=h(s);return{full:s,path:E(s),name:f(s),ext:e?"":S(s),file:!e,user:r[0],group:r[1],permBytes:i,perms:(e?"d":"-")+p(i),size:e?0:new Blob([R(s)]).size}})(t)).sort((t,e)=>t.full<e.full?-1:t.full>e.full?1:0);return Promise.resolve(e)}catch(t){return Promise.reject(t)}},touch:(t,e)=>T(t,"",e),mkdir:(t,e)=>{const s=e.getIdentity();try{return t=k(t,s),_(t)?Promise.resolve(!1):((t=>{t=E(t),w(t)})(t),(t=>{if(I(t))throw new Error(["Access Error","Path exists",t].join(" : "))})(t),b(t,2,s),Promise.resolve(M(t,s)))}catch(t){return Promise.reject(t)}},getExec:L,execRead:(t,e)=>{const s=e.getIdentity();return new Promise((e,r)=>{L(t,s).then(t=>{j(t,s).then(s=>e([t,s])).catch(t=>r(t))}).catch(t=>r(t))})},chmod:(t,e,s)=>{try{const r=e.getIdentity();if(t=k(t,r),C(t),"string"!=typeof s||3!==s.length)throw new Error(["FS Error",""+s,"must be 3 digits long"].join(" : "));const i=parseInt("0x"+s.charAt(1),16),o=parseInt("0x"+s.charAt(0),16),n=parseInt("0x"+s.charAt(2),16);if(r.priveledged||c(t)===r.user)return Promise.resolve(x(t,o,i,n));throw new Error(["FS ERROR",t,"Permissions can only be changed by root or owner"].join(" : "))}catch(t){return Promise.reject(t)}},chown:(t,e,s,r)=>{const i=e.getIdentity();try{if(t=k(t,i),D(t),i.priveledged)return Promise.resolve(F(t,i,s,r));throw new Error(["FS Error","chown","requires root"].join(" : "))}catch(t){Promise.reject(t)}},resolveWorkingPaths:(t,e)=>Promise.resolve(t.map(t=>k(t,e.getIdentity(),!1))),append:(t,e,s)=>new Promise((r,i)=>{j(t,s).then(o=>{o=o||"",T(t,o+=e,s).then(t=>{r(t)}).catch(t=>{i(t)})}).catch(()=>{T(t,e,s).then(t=>{r(t)}).catch(t=>{i(t)})})}),dirExists:(t,e)=>{const s=e.getIdentity();return t=k(t,s),Promise.resolve(_(t))},fileExists:(t,e)=>{const s=e.getIdentity();return t=k(t,s),Promise.resolve(I(t))}}},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var r=s(0);class i{constructor(t,e,s){this.env={},e=e||[],s=s||"/",this.user=t.toLowerCase(),this.groups=[...e,this.user].filter((t,e,s)=>s.indexOf(t)===e).map(t=>t.toLowerCase()),this.workingDir=s,this.priveledged="root"===this.user,this.setEnv("path",["/bin"])}setEnv(t,e){e instanceof Array&&(e=e.join(";")),this.env[t]=e}getEnv(t,e){return this.env.hasOwnProperty(t)?this.env[t]:e||""}getIdentity(){return this.clone()}setPriveledged(t){this.priveledged=t}async changeWorkingPath(t){try{if(await r.b.list(t,this)instanceof Array)return this.workingDir=t,Promise.resolve(!0)}catch(t){return Promise.reject(t)}return Promise.resolve(!1)}clone(){const t=new i(this.user+"",[...this.groups],this.workingDir+"");return t.setPriveledged(!0===this.priveledged),Object.entries(this.env).forEach(e=>{t.setEnv(e[0],e[1])}),t}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Process}));var _Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_Identity__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1),_OSLib__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3);class Process{constructor(t,e,s,r,i,o){if(this.code="",this.dead=!1,this.children=[],this.parentInCB=null,this.parentEndCB=null,this.parentID=-1,this.api={Std:{out:t=>this.hasParent()?this.intoParent(t):this.api.Display.print({data:t,over:0}),in:t=>this.intoChild(t.pid,t.data,t.source||null)},FS:{list:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.list(t,this),mkdir:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.mkdir(t,this),resolve:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.resolveWorkingPaths(t,this),append:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.append(t.path,t.content,this),write:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.write(t.path,t.content,this),touch:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.touch(t,this),read:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.read(t,this),del:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.del(t,this),dirExists:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.dirExists(t,this),fileExists:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.fileExists(t,this),delDir:t=>_Services_FileSystem__WEBPACK_IMPORTED_MODULE_0__.b.delDir(t,this)},Process:{end:()=>this.kill(),setEnv:t=>this.setEnv(t.prop,t.value,t.pid),self:()=>Promise.resolve(this.data()),start:t=>this.manager.startProcess(t.exec,t.params,null,this),crash:t=>(this.api.Std.out(t),this.kill()),changeWorkingPath:t=>this.changeWorkingPath(t)},Display:{prompt:t=>this.manager.getDisplay().setText(t),print:t=>this.manager.getDisplay().output(t.data,t.over,!1),printLn:t=>this.manager.getDisplay().output(t.data,t.over,!0),info:()=>this.manager.getDisplay().info()}},this.manager=t,this.exec=e,this.id=s,this.lib=new _OSLib__WEBPACK_IMPORTED_MODULE_2__.a((t,e)=>this.call(t,e)),this.identity=i.getIdentity(),this.params=r,o instanceof Process){this.parentID=o.id;const t=o.registerChild(this);this.parentInCB=t[0],this.parentEndCB=t[1]}}getIdentity(){return this.identity instanceof _Identity__WEBPACK_IMPORTED_MODULE_1__.a?this.identity.getIdentity():this.identity}setEnv(t,e,s){if("number"==typeof s)return s===this.parentID||this.children.hasOwnProperty(s)?this.manager.setEnv(s,t,e):Promise.reject();switch(t){case"log":console.log("Process SET",e);break;case"workingPath":case"workingDir":this.changeWorkingPath(e);break;default:this.identity.setEnv(t,e)}return this.event(["Process","self"],this.data()),Promise.resolve()}start(code){this.code=code;const wrapper=["((proc,osLib)=>{\n",this.code,";\nreturn new Main(proc,osLib);\n})"].join("");return this.app=eval(wrapper)(this.data,this.lib),!0}hasParent(){return this.parentID>=0}intoParent(t){return null!==this.parentInCB?(this.parentInCB(t),Promise.resolve()):Promise.reject()}call(t,e){return this.api.hasOwnProperty(t.service)&&this.api[t.service].hasOwnProperty(t.func)?this.api[t.service][t.func](e):Promise.reject(new Error(["PM Error","Atempt to access non-existant System Call\n"+t.service+">"+t.func,this.exec+"["+this.id+"]"].join(" : ")))}data(){return{id:this.id,exec:this.exec,params:[...this.params],identity:this.identity,dead:this.dead,parentID:this.parentID}}registerChild(t){return this.children[t.id]=t,[e=>{this.stdIn(t.id,e)},()=>{this.removeChild(t)}]}removeChild(t){this.event(["Process","end"],t.id),delete this.children[t.id]}intoChild(t,e,s){return this.children.hasOwnProperty(t)?this.children[t].stdIn(e,s):Promise.reject()}stdIn(t,e){return this.event(["Std","in"],{from:t,data:e})}async changeWorkingPath(t){this.identity.changeWorkingPath(t)}event(t,e){return this.lib.fireEvent({service:t[0],func:t[1]},e)}kill(){return this.dead=!0,delete this.app,delete this.lib,null!==this.parentEndCB&&this.parentEndCB(),Promise.resolve()}}},function(t,e,s){"use strict";var r={loadArgs:(t,e,s)=>{let r=[];for(let i=0;i<t.length;i++){let o=t[i];if(o.startsWith("--")&&o.length>2){if(o=o.slice(2),!e.hasOwnProperty(o))return Promise.reject(new Error(["Load Args Error","unrecognized option '--"+o+"'\nTry '--help' for more information.",JSON.stringify(t)].join(" : ")));i<t.length-1&&!t[i+1].startsWith("-")&&"boolean"!=typeof e[o]?(i++,e[o]=t[i]):e[o]=!e[o]}else if(o.startsWith("-")&&o.length>1&&"--"!==o){o=o.slice(1);for(let t=0;t<o.length;t++){const r=o.charAt(t);s.hasOwnProperty(r)&&(e[s[r]]=!e[s[r]])}}else r=[...r,o]}return Promise.resolve(r)},bytesToHuman:(t,e,s)=>{(s=!0===s)&&(t*=8);const r=(e=!0===e)?1e3:1024,i=s?e?["b","kb","mb","gb","pb"]:["b","Kb","Mb","Gb","Pb"]:e?["B","kB","mB","gB","pB"]:["B","KB","MB","GB","PB"];let o=0;for(;t>r;)t/=r,o++;return Math.round(t)+i[o]}};s.d(e,"a",(function(){return i}));class i{constructor(t){this.hooks={},this.awaitProcs={},this.Std={event:{in:t=>this.hookEvent("Std","in",t)},out:t=>this.call("Std","out",t),in:(t,e,s)=>this.call("Std","in",{pid:t,data:e,source:s})},this.FS={list:t=>this.call("FS","list",t),mkdir:t=>this.call("FS","mkdir",t),resolve:t=>this.call("FS","resolve",t),append:(t,e)=>this.call("FS","append",{path:t,content:e}),write:(t,e)=>this.call("FS","write",{path:t,content:e}),touch:t=>this.call("FS","touch",t),read:t=>this.call("FS","read",t),del:t=>this.call("FS","del",t),dirExists:t=>this.call("FS","dirExists",t),fileExists:t=>this.call("FS","fileExists",t),delDir:t=>this.call("FS","delDir",t)},this.Process={event:{start:t=>this.hookEvent("Process","start",t),msg:t=>this.hookEvent("Process","msg",t),end:t=>this.hookEvent("Process","end",t),self:t=>this.hookEvent("Process","self",t)},end:()=>this.call("Process","end"),self:()=>this.call("Process","self"),start:(t,e)=>this.call("Process","start",{exec:t,params:e}),crash:t=>this.call("Process","crash",t),changeWorkingPath:t=>this.call("Process","changeWorkingPath",t),msg:(t,e)=>this.call("Process","msg",{pid:t,msg:e}),kill:t=>this.call("Process","kill",t),list:()=>this.call("Process","list"),startAndAwaitOutput:(t,e)=>this.startAndAwait(t,e)},this.Display={prompt:t=>this.call("Display","prompt",t),printRaw:(t,e,s)=>this.call("Display","print",{data:t,over:e||0,newLine:!0===s}),print:(t,e)=>this.Display.printRaw(t,e,!1),printLn:(t,e)=>this.Display.printRaw(t,e,!0),info:()=>this.call("Display","info")},this.Util=r,this._call=t}call(t,e,s){return this._call({service:t,func:e},s)}hookEvent(t,e,s){const r=t+":"+e;this.hooks[r]=s}startAndAwait(t,e){return new Promise((s,r)=>{this.Process.start(t,e).then(t=>{this.awaitProcs[t.id]={resolve:s,reject:r}}).catch(t=>r(t))})}fireEvent(t,e){return this.fireHooks(t,e)}awaitIn(t){return!("number"!=typeof t.from||!this.awaitProcs.hasOwnProperty(t.from))&&(this.awaitProcs[t.from].resolve(t),delete this.awaitProcs[t.from],!0)}fireHooks(t,e){const s=t.service+":"+t.func;return"Std:in"===s&&this.awaitIn(e)?Promise.resolve():this.hooks.hasOwnProperty(s)?this.hooks[s](e):Promise.reject("MISSING")}}},function(t,e,s){"use strict";s.r(e);var r=s(0),i=s(1);class o{init(t){console.log("STUB DISPLAY INIT",t)}setText(t){return console.log("STUB DISPLAY SET TEXT",t),Promise.resolve()}output(t,e,s){return console.log("STUB DISPLAY OUTPUT",t,e,s),Promise.resolve()}info(){return console.log("STUB DISPLAY INFO"),Promise.resolve({})}}var n=s(2);const a={ls:()=>{const t={all:!1,human:!1,long:!1,"no-group":!1,raw:!1};let e,s=0;const r={a:"all",h:"human",l:"long",G:"no-group"},i=e=>{let s=e.name;if(t.raw)return s;s.indexOf(" ")>=0&&(s="'"+s+"'");let r=CMD.Colours.white,i=CMD.Colours.black;return e.file||(r=CMD.Colours.blue),CMD.Colourize(s,r,i)},o=(e,s)=>{let r=[e,["perms\t","user",t["no-group"]?"":"group","size","name"].filter(t=>t.length>0)];return s.map(e=>(e=>{const s={perms:e.perms,user:e.user,group:e.group,size:e.size,name:i(e)};return t["no-group"]&&delete s.group,Object.values(s)})(e)).map(t=>r.push(t)),r},n=(r,n)=>{let a;t.all||(n=n.filter(t=>!t.name.startsWith("."))),a=t.long?o(r,n):(t=>t.map(t=>i(t)))(n),OS.Std.out(a),++s>=e&&OS.Process.end()},a=t=>{OS.Process.crash(t)};(async s=>{try{let i=await OS.Util.loadArgs(s,t,r);(e=i.length)<1&&(i=[""],e=1),i.map(t=>(t=>{OS.FS.list(t).then(e=>n(t,e)).catch(t=>a(t))})(t))}catch(t){a(t)}})(PROCESS.params)},bash:class{constructor(t,e){this.bashHistoryFile="~/.bash_history",this.host=window.location.origin.split("://")[1].split(":")[0]||"[MISSING HOST]",this.activeProcessID=-1,this.activeOutputed=!1,this.subProcs={},this.history=[],this.historyPosition=0,this.bashProcess=t,this.api=e,this.api.Process.event.self(t=>this.selfUpdate(t)),this.api.Process.event.end(t=>this.end(t)),this.api.Std.event.in(t=>this.stdIn(t)),this.start()}setHistoryPosition(t){this.historyPosition=Math.min(Math.max(t,0),history.length)}showHistory(t){this.setHistoryPosition(t),this.api.Display.prompt(this.history[this.history.length-this.historyPosition])}newHistory(t){t.length>0&&t!==this.history[this.history.length-1]&&(this.history.push(t),this.api.FS.append(this.bashHistoryFile,t+"\n")),this.historyPosition=0}getSubProc(t){return this.subProcs.hasOwnProperty(t)?this.subProcs[t]:null}printPrompt(t){t=!0===t,this.api.Std.out((t?"\n":"")+CMD.Colourize(this.bashProcess.identity.user+"@"+this.host,CMD.Colours.green)+CMD.Colourize(":",CMD.Colours.white)+CMD.Colourize(this.bashProcess.identity.workingDir.replace("/home/"+this.bashProcess.identity.user,"~"),CMD.Colours.blue)+CMD.Colourize("$ ",CMD.Colours.white))}splitUserInput(t){return(t.match(/(".*?"|[^" \s]+)(?=\s* |\s*$)/g)||[]).map(t=>('"'===(t=t.trim()).charAt(0)&&'"'===t.charAt(t.length-1)&&(t=t.slice(1,t.length-1)),t))}start(){this.api.FS.read(this.bashHistoryFile).then(t=>{this.history=t.split("\n").filter(t=>t.length>0).filter((t,e,s)=>e>0&&s[e-1]!==t)}),this.printPrompt()}resolveAppIn(t){const e=this.getSubProc(parseInt(t.from));let s=t.data;return t.data instanceof Array&&null!==e&&"ERROR"===t.data[0]&&(s=e.exec.split("/").pop()+": "+t.data[2]),parseInt(t.from,10)===this.activeProcessID&&(this.activeOutputed=!0),this.api.Std.out(s),Promise.resolve("asd")}ctrlCode(t){switch(console.log("CTRL CODE",t),t){case"c":this.api.Std.out("^C"),this.printPrompt(!0),this.api.Display.prompt("")}}async tabComplete(t){const e=this.splitUserInput(t);let s=null;if(1===e.length);else{const r=e[e.length-1].split("/"),i=r.slice(0,r.length-1).join("/"),o=r[r.length-1],n=["--raw"];o.startsWith(".")&&n.push("--all"),n.push(i);const a=(await this.api.Process.startAndAwaitOutput("ls",n)).data;console.log({text:t,parts:e,dirs:r,dir:i,t:o,opts:a});const l=a.filter(t=>t.startsWith(o));if(1===l.length){r[r.length-1]=l[0];const t=r.join("/");console.log(t);const s=await this.api.FS.dirExists(t);e[e.length-1]=t+(s?"/":"")}else s=a}null!==s&&(this.api.Std.out(t+"\n"),this.api.Std.out(s),this.printPrompt(!0)),this.api.Display.prompt(e.map(t=>t.indexOf(" ")>=0?'"'+t+'"':t).join(" "))}specialCode(t){const e=t.split("§§§").filter(t=>t.length>0);switch(e[0].toLowerCase()){case"ctrl":this.ctrlCode(e[1]);break;case"dir":this.showHistory(parseInt(e[1],10)+this.historyPosition);break;case"tab":this.tabComplete(e[1]);break;default:console.log("SPECIAL CODE",e)}}selfUpdate(t){return console.log("UPDATE SELF",t),this.bashProcess=t,Promise.resolve()}async stdIn(t){if("user"===t.from){if("string"==typeof t.data)if(t.data.startsWith("§§§"))this.specialCode(t.data);else{if(this.activeProcessID>0)return console.log("PASS ON STD IN",this.bashProcess.id),void this.api.Std.in(this.activeProcessID,t.data,t.from);if("exit"===t.data)return void this.api.Process.end();const e=this.splitUserInput(t.data),s=e.shift()||"";try{const t=await this.api.Process.start(s,e);this.activeOutputed=!1,this.subProcs[t.id]=t,this.activeProcessID=t.id}catch(t){console.log("EXEC ERROR",t);try{"FS Error"===t[1]&&"Not found"===t[3]?this.api.Std.out(s+": command not found"):this.api.Std.out(t[1])}catch(t){this.api.Std.out(["BASH LAUNCH ERROR",t.message])}this.printPrompt(!0)}this.newHistory(t.data)}}else{const e=await this.resolveAppIn(t);"string"!=typeof e&&console.log(e)}}end(t){return null!==this.getSubProc(t)&&(delete this.subProcs[t],t===this.activeProcessID&&(this.activeProcessID=-1,this.printPrompt(this.activeOutputed))),Promise.resolve()}},mkdir:()=>{const t=[["Usage: mkdir[OPTION]...DIRECTORY..."],["Create the DIRECTORY(ies), if they do not already exist."],[""],["Mandatory arguments to long options are mandatory for short options too."],["  - p, --parents","no error if existing, make parent directories as needed"],["  - v, --verbose","print a message for each created directory"],["  ","--help","","display this help and exit"],["  ","--version","output version information and exit"]],e=["mkdir (GNU coreutils) 0.1","Copyright(C) 2010 wlf.io.","License MIT License < https://raw.githubusercontent.com/wlfio/TSPseudoOS/master/LICENSE >.","This is free software: you are free to change and redistribute it.","There is NO WARRANTY, to the extent permitted by law.","","Written by wlf.io."].join("\n"),s={help:!1,version:!1,verbose:!1,parents:!1},r={"?":"help",v:"verbose",p:"parents"};const i=async t=>{let e="";try{const r=await OS.FS.resolve(t);console.log("PATHS",r);const i=(t=>t.map(t=>s.parents?(t=>{return t.split("/").filter(t=>t.length>0).reduce((t,e,s)=>(e=0===s?"/"+e:t[t.length-1]+"/"+e,t.push(e),t),[])})(t):[t]))(r);console.log("BROKEN",i);for(let t=0;t<i.length;t++){const r=i[t];for(let t=0;t<r.length;t++){const i=r[t],o=await OS.FS.mkdir(i);console.log("PATH DONE",i,o),s.verbose&&o&&OS.Std.out(e+"created directory '"+r[0]+"'"),o||s.parents||OS.Std.out(e+"cannot create directory '"+r[0]+"': File exists"),e="\n"}}OS.Process.end()}catch(t){console.log("ERROROR",t),(t=>{t instanceof Array&&"Path is not directory"===t[2]&&(t=new Error("MKDIR ERROR : no such file or directory '"+t[3]+"' : "+t.join(" : "))),OS.Process.crash(t)})(t)}};(async o=>{const n=await OS.Util.loadArgs(o,s,r);n.length<1&&!s.help&&!s.version?OS.Process.crash(new Error(["mkdir error","missing operand\nTry 'mkdir --help' for more information",JSON.stringify(o)].join(" : "))):s.help?OS.Std.out(t):s.version?OS.Std.out(e):i(n)})(PROCESS.params)},cat:()=>{const t={number:!1,"squeeze-blank":!1},e={n:"number",s:"squeeze-blank"};let s=0;const r=t=>{OS.Process.crash(t)},i=e=>{OS.Std.out((e=>{const r=[];let i=!1;return e.split("\n").forEach(e=>{if(s++,e.length<1){if(i)return;i=!0}else i=!1;const o=[];t.number&&o.push(s.toString()),o.push(e),r.push(o)}),r})(e))};(s=>{OS.Util.loadArgs(s,t,e).then(t=>{if(t.length<1)throw new Error("CAT ERROR : you must include file path(s) : "+JSON.stringify(s));(async t=>{try{for(let e=0;e<t.length;e++){const s=await OS.FS.read(t[e]);i(s)}OS.Process.end()}catch(t){r(t)}})(t)}).catch(t=>{console.log("CAT ERROR",t),r(t)})})(PROCESS.params)},touch:(t,e)=>{new class{constructor(t){this.options={verbose:!1},this.optMap={v:"verbose"},this.firstOut=!0,this.loadArgs(t)}async loadArgs(t){try{const s=await e.Util.loadArgs(t,this.options,this.optMap);this.run(s)}catch(t){this.error(t)}}error(t){e.Process.crash(t)}async run(t){for(let s=0;s<t.length;s++){const r=await e.FS.touch(t[s]);this.printOutput(r)}e.Process.end()}printOutput(t){this.options.verbose&&(e.Std.out((this.firstOut?"":"\n")+"created '"+t[0]+"'"),this.firstOut=!1)}}(t.params)},rm:()=>{new class{constructor(t){this.options={verbose:!1,recursive:!1},this.optMap={v:"verbose",r:"recursive"},this.firstOut=!0,this.loadArgs(t)}async loadArgs(t){try{const e=await OS.Util.loadArgs(t,this.options,this.optMap);this.run(e)}catch(t){this.error(t)}}error(t){OS.Process.crash(t)}async run(t){try{t=await OS.FS.resolve(t);for(let e=0;e<t.length;e++){const s=t[e];let r;await OS.FS.dirExists(s)?this.options.recursive?r=await OS.FS.delDir(s):this.printDirError(s):r=await OS.FS.del(s),this.printOutput(r)}OS.Process.end()}catch(t){this.error(t)}}printOutput(t){this.options.verbose&&this.output("deleted '"+t[0]+"'")}printDirError(t){this.output("cannot remove '"+t+"' it's a directory")}output(t){OS.Std.out((this.firstOut?"":"\n")+"rm: "+t),this.firstOut=!1}}(PROCESS.params)},cd:class{constructor(t,e){this.options={},this.optMap={},this.firstOut=!0,this.api=e,this.proc=t,this.loadArgs(t.params)}async loadArgs(t){try{const e=await this.api.Util.loadArgs(t,this.options,this.optMap);this.run(e)}catch(t){this.error(t)}}error(t){this.api.Process.crash(t)}async run(t){try{if(this.proc.parentID>0){t=await this.api.FS.resolve(t);const e=await this.api.Process.changeWorkingPath(t[0],this.proc.parentID);console.log("CHANGE DIR",e)}this.api.Process.end()}catch(t){this.error(t)}}},tail:()=>{new class{constructor(t){this.options={follow:!1},this.optMap={f:"follow"},this.files={},this.loadArgs(t.params)}error(t){OS.Process.crash(t)}async loadArgs(t){const e=await OS.Util.loadArgs(t,this.options,this.options);try{await this.run(e)}catch(t){this.error(t)}console.log(e),OS.Process.end()}async run(t){this.files=await this.readFiles(t),console.log(this.files),this.options.follow||OS.Process.end()}async readFiles(t){const e={};for(let s=0;s<t.length;s++){const r=t[s];e[r]=await OS.FS.read(r)}return e}}(PROCESS)},head:class{constructor(t){this.str=t}},edit:class{constructor(){this.bob=1}}},l=new i.a("root",[],"/"),c=new i.a("guest",[],"/home/guest"),h=(()=>{try{return window.self!==window.top}catch(t){return!0}})();Object(r.a)(l),r.b.mkdir("/bin",l),r.b.mkdir("/home",l),r.b.mkdir("/home/guest",l).then(()=>{r.b.chown("/home/guest",l,"guest","guest").then(()=>{r.b.mkdir("/home/guest/bin",c),r.b.write("/home/guest/test","Lorem ipsum dolor sit amet, consectetur \n\n\n\n\n\n\n adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",c),r.b.mkdir("/home/guest/bin",c)})}),r.b.mkdir("/home/root",l),Object.entries(a).map(t=>{r.b.write("bin/"+t[0],t[1].toString(),l),r.b.chmod("bin/"+t[0],l,"755")});const u=new class{constructor(){this.queuedItems=[],this.processManager=null,this.display=document.createElement("div"),this.input=document.createElement("span")}info(){return Promise.resolve({})}init(t){this.processManager=t,this.createDisplay(),document.addEventListener("keydown",()=>{document.activeElement!==this.input&&this.input.focus()}),this.input.addEventListener("keydown",t=>{if(t.ctrlKey&&"Control"!==t.key&&!t.repeat&&"F5"!==t.key)this.controlKey(t.key);else if("ArrowUp"!==t.key&&"ArrowDown"!==t.key||t.repeat)if("Enter"===t.key)t.repeat||this.enterText();else{if("Tab"!==t.key)return;this.tabKey(),console.log("TAB KEY"),t.preventDefault()}else this.history("ArrowDown"===t.key?-1:1);t.preventDefault()}),this.processQueue()}colourizeText(t){return t.split(/(?=§[0-9A-F]{6})/).map(t=>{const e=document.createElement("span");if(t.startsWith("§")){const s=t.slice(0,7);e.setAttribute("style","color:#"+s.slice(1,4)+";background-color:#"+s.slice(4,7)+";"),t=t.slice(7)}return e.textContent=t,e})}breakUptext(t){const e=[];return t.split("\n").forEach((t,s,r)=>{const i=document.createElement("span");this.colourizeText(t).forEach(t=>{i.append(t)}),e.push(i),s<r.length-1&&e.push(document.createElement("br"))}),e}writeToDisplay(t,e){e=e||0,t.map(t=>{this.display.insertBefore(t,this.input)})}reduceArrayForDisplay(t,e){return t.reduce((t,s,r)=>{const i=typeof s;return"string"===i||"number"===i?t+=(r<1?"":"\t")+s:s instanceof Array&&(t+=(r<1?"":"\n")+this.reduceArrayForDisplay(s,e+1)),t},"")}processDisplayData(t){return t instanceof Array?this.reduceArrayForDisplay(t,0):(console.log(t),"FAILED TO CONVERT FOR DISPLAY")}output(t,e,s){s=!0===s;let r="";r="string"!=typeof t?this.processDisplayData(t):t;const i=this.breakUptext(r);return s&&i.push(document.createElement("br")),this.writeToDisplay(i,e),Promise.resolve()}prompt(t){console.log("PROMPT",t)}processQueue(){this.queuedItems.map(t=>{this.writeToDisplay(t.text,t.over)})}createDisplay(){this.display.id="output",this.display.tabIndex=-1,this.input.id="input",this.input.tabIndex=0,this.input.contentEditable="true",this.input.spellcheck=!1;const t=document.querySelector("body");null!==t&&(t.append(this.display),this.display.append(this.input))}history(t){this.specialUserInput("DIR",t.toString())}controlKey(t){this.inputOutput(!1),this.specialUserInput("CTRL",t)}setText(t){this.input.textContent=t;const e=document.createRange()||new Range;var s=window.getSelection()||new Selection;const r=this.input.childNodes;return console.log("DISPLAY",r[r.length-1]),t.length>0?e.setStart(r[r.length-1],this.input.textContent.length):e.setStart(this.input,this.input.textContent.length),e.collapse(!0),s.removeAllRanges(),s.addRange(e),this.input.focus(),Promise.resolve()}enterText(){const t=this.inputOutput();t.length>0&&(this.userInput(t),this.setText(""))}inputOutput(t){t=!1!==t;const e=this.input.textContent||"";return e.length>0&&this.output(e,0,t),e}specialUserInput(t,e){this.userInput("§§§"+t+"§§§"+e)}userInput(t){null!==this.processManager&&this.processManager.stdIn("user",t)}tabKey(){this.specialUserInput("tab",this.input.textContent||"")}},p=new class{constructor(){this.display=null,this.processes={},this.pids=0,this.pending=[],this.libJS=null,this.mainProcess=null}setEnv(t,e,s){return this.processes.hasOwnProperty(t)?(this.processes[t].setEnv(e,s),Promise.resolve()):Promise.reject()}init(t){this.display=t}killProcess(t){const e=this.getProcessFromID(t);null!==e&&e.kill()}stdIn(t,e){null!==this.mainProcess?this.mainProcess.stdIn(t,e):console.log("STDIN",e)}async startProcess(t,e,s,o){if(s instanceof i.a||o instanceof n.a&&(s=o.getIdentity()),!(s instanceof i.a))throw new Error("Identity is not identity");e=e.filter(t=>t.length>0);try{const i=await r.b.execRead(t,s);this.pids++;const a=i[0],l=i[1].trim(),c=new n.a(this,a,this.pids,e,s,o);return c.start(l),this.processes[this.pids]=c,null===this.mainProcess&&(this.mainProcess=c),c}catch(t){return console.log(["Process Error",t]),Promise.reject(["Process Error",t])}}getProcessFromID(t){return Object.values(this.processes).find(e=>e.id===t)||null}getDisplay(){return null!==this.display?this.display:new o}};document.addEventListener("DOMContentLoaded",()=>{console.log(location.host,h),u.init(p),p.init(u),u.output([["Welcome to wlf.io TSPseudoOS v0.1 LTNS(Little To No Support)"],[""],["  * Try the command help to see what you can do"],[""],["Last Login: Fri, 25 Oct 2019 18: 57: 47 GMT"]],0,!0),p.startProcess("bash",[],c)})}]);
//# sourceMappingURL=os.bundle.js.map