!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=3)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=t=>("/"!==t.charAt(0)&&(t="/"+t),"/"!==t.charAt(t.length-1)&&(t+="/"),t),r=t=>"/"+t.split("/").reduce((t,e)=>e.length>0&&"."!==e?".."===e?t.slice(0,t.length-1):[...t,e]:t,[]).join("/"),o=t=>0!==t.indexOf("FSF:")?"FSF:"+r(t):t,n=t=>0!==t.indexOf("FSD:")?"FSD:"+r(t):t,a=t=>0!==t.indexOf("FSP:")?"FSP:"+r(t):t,l=t=>0!==t.indexOf("FSO:")?"FSO:"+r(t):t,h=t=>(t=>localStorage.getItem(l(t))||"nobody:nobody")(t).split(":"),c=t=>h(t)[0],u=t=>parseInt(localStorage.getItem(a(t))||"",16),p=t=>{let e="";return e+=4&t?"r":"-",e+=2&t?"w":"-",e+=1&t?"x":"-"},d=t=>p(t>>8)+p(t>>4)+p(t>>0),f=t=>u(t)>>8,m=t=>u(t)>>4,g=t=>u(t)>>0,y=(t,e,s)=>{return!!(s.groups.includes((t=>h(t)[1])(t))&&m(t)&e)},P=(t,e,s)=>((t,e,s)=>{const i=s.user;return s.priveledged?!(1&e)||(1&f(t)||1&m(t)||1&g(t)):!!(i===c(t)&&f(t)&e)})(t,e,s)||y(t,e,s)||((t,e)=>!!(g(t)&e))(t,e),v=t=>t.split("/").pop()||"",S=t=>{const e=v(t).split(".");return e.length>1&&e.pop()||""},w=t=>((t.length<1||"/"===t)&&(t="/"),"___dir___"===localStorage.getItem(n(t)));e.createRoot=t=>{M("/",t)};const b=t=>{if(!w(t))throw console.trace(),new Error(["Access Error","Path is not directory",t].join(" : "))},O=t=>{const e=t.split("/");return t=e.slice(0,e.length-1).join("/")},_=(t,e,s)=>{if(!P(t,e,s))throw new Error(["Permissions Error","Denied "+p(e),t].join(" : "))},E=(t,e,s)=>_(O(t),e,s),I=t=>{if(!w(t))throw new Error(["Access Error","Cannot access '"+t+"': No such file or directory",t].join(" : "))},D=t=>null!==localStorage.getItem(o(t));e.fileExists=(t,e)=>{const s=e.getIdentity();return t=F(t,s),Promise.resolve(D(t))};const k=t=>{if(!D(t))throw new Error(["Access Error","Cannot access '"+t+"': No such file",t].join(" : "))};e.dirExists=(t,e)=>{const s=e.getIdentity();return t=F(t,s),Promise.resolve(w(t))};const x=(t,e)=>(e=i(e||"/"),"/"!==(t=t.trim()).charAt(0)&&(t=e+t),t=r(t)),F=(t,e,s)=>(s=!1!==s,"~"===(t=t.trim()).charAt(0)&&(t=t.replace("~","/home/"+e.user+"/")),t=x(t,e.workingDir),s&&((t,e)=>{const s=(t=O(t)).split("/");for(let t=2;t<=s.length;t++){const i=s.slice(0,t).join("/");b(i),_(i,1,e)}})(t,e),t);e.resolveWorkingPaths=(t,e)=>Promise.resolve(t.map(t=>F(t,e.getIdentity(),!1)));const C=(t,e,s,i)=>{let r=0;r|=e<<8,r|=s<<4,r|=i<<0,localStorage.setItem(a(t),"0x"+r.toString(16))};e.chmod=(t,e,s)=>{try{const i=e.getIdentity();if(t=F(t,i),k(t),"string"!=typeof s||3!==s.length)throw new Error(["FS Error",""+s,"must be 3 digits long"].join(" : "));const r=parseInt("0x"+s.charAt(1),16),o=parseInt("0x"+s.charAt(0),16),n=parseInt("0x"+s.charAt(2),16);if(i.priveledged||c(t)===i.user)return Promise.resolve(C(t,o,r,n));throw new Error(["FS ERROR",t,"Permissions can only be changed by root or owner"].join(" : "))}catch(t){return Promise.reject(t)}};const A=(t,e,s,i)=>{localStorage.setItem(l(t),[s||e.user,i||e.user].join(":"))};e.chown=(t,e,s,i)=>{const r=e.getIdentity();try{if(t=F(t,r),I(t),r.priveledged)return Promise.resolve(A(t,r,s,i));throw new Error(["FS Error","chown","requires root"].join(" : "))}catch(t){Promise.reject(t)}};const M=(t,e)=>!w(t)&&(localStorage.setItem(n(t),"___dir___"),C(t,7,5,5),A(t,e),!0);e.mkdir=(t,e)=>{const s=e.getIdentity();try{return t=F(t,s),w(t)?Promise.resolve(!1):((t=>{t=O(t),b(t)})(t),(t=>{if(D(t))throw new Error(["Access Error","Path exists",t].join(" : "))})(t),E(t,2,s),Promise.resolve(M(t,s)))}catch(t){return Promise.reject(t)}};e.write=(t,e,s)=>{const i=s.getIdentity();try{t=F(t,i);const s=D(t);return s?_(t,2,i):E(t,2,i),Promise.resolve(((t,e,s,i)=>(s=!0===s,localStorage.setItem(o(t),e),s||(C(t,6,4,4),A(t,i)),[t,e]))(t,e,s,i))}catch(t){return Promise.reject(t)}},e.touch=(t,s)=>e.write(t,"",s);const j=t=>localStorage.getItem(o(t));e.read=(t,e)=>{const s=e.getIdentity();try{return t=F(t,s),k(t),_(t,4,s),Promise.resolve(j(t))}catch(t){return Promise.reject(t)}},e.append=(t,s,i)=>new Promise((r,o)=>{e.read(t,i).then(n=>{n=n||"",n+=s,e.write(t,n,i).then(t=>{r(t)}).catch(t=>{o(t)})}).catch(()=>{e.write(t,s,i).then(t=>{r(t)}).catch(t=>{o(t)})})});e.del=(t,e)=>{const s=e.getIdentity();try{return t=F(t,s),E(t,2,s),k(t),Promise.resolve((t=>(localStorage.removeItem(o(t)),localStorage.removeItem(a(t)),localStorage.removeItem(l(t)),t))(t))}catch(t){return Promise.reject(t)}};e.delDir=(t,e)=>{const s=e.getIdentity();try{return t=F(t,s),E(t,2,s),I(t),Promise.resolve((t=>{Object.keys(localStorage).forEach(e=>{e.slice(4).startsWith(t)&&localStorage.removeItem(e)})})(t))}catch(t){return Promise.reject(t)}};e.list=(t,e)=>{const s=e.getIdentity();try{t=F(t,s),console.log("LIST PATH RESOLVE",t),I(t),console.log("LIST DIR CHECK",t),_(t,4,s);let e=(t=>{t=i(t);let e=o(t),s=n(t);const r=t.split("/").length;return console.log(e,s,r),Object.keys(localStorage).filter(t=>t.startsWith(e)||t.startsWith(s)).filter(t=>t.split("/").length<=r).map(t=>{const e=t.split(":");return{file:"FSF"===e[0],path:e[1]}})})(t);return console.log("LIST PATHS",t,e),e=(e=e.map(e=>((t,e)=>{const s=!e.file,i=e.path,r=h(i),o=u(i);return{full:i,path:O(i),name:t===i?".":v(i),ext:s?"":S(i),file:!s,user:r[0],group:r[1],permBytes:o,perms:(s?"d":"-")+d(o),size:s?0:new Blob([j(i)]).size}})(t,e))).sort((t,e)=>t.full<e.full?-1:t.full>e.full?1:0),Promise.resolve(e)}catch(t){return Promise.reject(t)}},e.getExec=(t,e)=>{const s=e.getIdentity();try{const e=((t,e)=>[F(t,e),...e.getEnv("path","/bin").split(";").map(e=>x(t,e))])(t=(t=>t.replace(/\//g,""))(t),s);for(let t=0;t<e.length;t++){const i=e[t];if(D(i)&&P(i,1,s))return Promise.resolve(i)}throw new Error(["FS Error",t,"Not found"].join(" : "))}catch(t){return Promise.reject(t)}},e.execRead=(t,s)=>{const i=s.getIdentity();return new Promise((s,r)=>{e.getExec(t,i).then(t=>{e.read(t,i).then(e=>s([t,e])).catch(t=>r(t))}).catch(t=>r(t))})},e.default={read:e.read,write:e.write,del:e.del,delDir:e.delDir,list:e.list,touch:e.touch,mkdir:e.mkdir,getExec:e.getExec,execRead:e.execRead,chmod:e.chmod,chown:e.chown,resolveWorkingPaths:e.resolveWorkingPaths,append:e.append,dirExists:e.dirExists,fileExists:e.fileExists}},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0));class o{constructor(t,e,s){this.env={},e=e||[],s=s||"/",this.user=t.toLowerCase(),this.groups=[...e,this.user].filter((t,e,s)=>s.indexOf(t)===e).map(t=>t.toLowerCase()),this.workingDir=s,this.priveledged="root"===this.user,this.setEnv("path",["/bin"])}setEnv(t,e){e instanceof Array&&(e=e.join(";")),this.env[t]=e}getEnv(t,e){return this.env.hasOwnProperty(t)?this.env[t]:e||""}getIdentity(){return this.clone()}setPriveledged(t){this.priveledged=t}async changeWorkingPath(t){try{if(await r.default.list(t,this)instanceof Array)return this.workingDir=t,Promise.resolve(!0)}catch(t){return Promise.reject(t)}return Promise.resolve(!1)}clone(){const t=new o(this.user+"",[...this.groups],this.workingDir+"");return t.setPriveledged(!0===this.priveledged),Object.entries(this.env).forEach(e=>{t.setEnv(e[0],e[1])}),t}}e.default=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.StubDisplay=class{init(t){console.log("STUB DISPLAY INIT",t)}setText(t){return console.log("STUB DISPLAY SET TEXT",t),Promise.resolve()}output(t,e,s){return console.log("STUB DISPLAY OUTPUT",t,e,s),Promise.resolve()}info(){return console.log("STUB DISPLAY INFO"),Promise.resolve({})}};e.default=class{constructor(){this.queuedItems=[],this.processManager=null,this.display=document.createElement("div"),this.input=document.createElement("span")}info(){return Promise.resolve({})}init(t){this.processManager=t,this.createDisplay(),document.addEventListener("keydown",()=>{document.activeElement!==this.input&&this.input.focus()}),this.input.addEventListener("keydown",t=>{if(t.ctrlKey&&"Control"!==t.key&&!t.repeat&&"F5"!==t.key)this.controlKey(t.key);else if("ArrowUp"!==t.key&&"ArrowDown"!==t.key||t.repeat)if("Enter"===t.key)t.repeat||this.enterText();else{if("Tab"!==t.key)return;this.tabKey(),console.log("TAB KEY"),t.preventDefault()}else this.history("ArrowDown"===t.key?-1:1);t.preventDefault()}),this.processQueue()}colourizeText(t){return t.split(/(?=§[0-9A-F]{6})/).map(t=>{const e=document.createElement("span");if(t.startsWith("§")){const s=t.slice(0,7);e.setAttribute("style","color:#"+s.slice(1,4)+";background-color:#"+s.slice(4,7)+";"),t=t.slice(7)}return e.textContent=t,e})}breakUptext(t){const e=[];return t.split("\n").forEach((t,s,i)=>{const r=document.createElement("span");this.colourizeText(t).forEach(t=>{r.append(t)}),e.push(r),s<i.length-1&&e.push(document.createElement("br"))}),e}writeToDisplay(t,e){e=e||0,t.map(t=>{this.display.insertBefore(t,this.input)})}reduceArrayForDisplay(t,e){return t.reduce((t,s,i)=>{const r=typeof s;return"string"===r||"number"===r?t+=(i<1?"":"\t")+s:s instanceof Array&&(t+=(i<1?"":"\n")+this.reduceArrayForDisplay(s,e+1)),t},"")}processDisplayData(t){return t instanceof Array?this.reduceArrayForDisplay(t,0):(console.log(t),"FAILED TO CONVERT FOR DISPLAY")}output(t,e,s){s=!0===s;let i="";i="string"!=typeof t?this.processDisplayData(t):t;const r=this.breakUptext(i);return s&&r.push(document.createElement("br")),this.writeToDisplay(r,e),this.scrollToBottom(),Promise.resolve()}scrollToBottom(){this.display.scrollTo(0,this.display.scrollHeight)}prompt(t){console.log("PROMPT",t)}processQueue(){this.queuedItems.map(t=>{this.writeToDisplay(t.text,t.over)})}createDisplay(){this.display.id="output",this.display.tabIndex=-1,this.display.classList.add("output"),this.input.id="input",this.input.classList.add("input"),this.input.tabIndex=0,this.input.contentEditable="true",this.input.spellcheck=!1;const t=document.querySelector("body");null!==t&&(t.append(this.display),this.display.append(this.input))}history(t){this.specialUserInput("DIR",t.toString())}controlKey(t){this.inputOutput(!1),this.specialUserInput("CTRL",t)}setText(t){this.input.textContent=t;const e=document.createRange()||new Range;var s=window.getSelection()||new Selection;const i=this.input.childNodes;return console.log("DISPLAY",i[i.length-1]),t.length>0?e.setStart(i[i.length-1],this.input.textContent.length):e.setStart(this.input,this.input.textContent.length),e.collapse(!0),s.removeAllRanges(),s.addRange(e),this.input.focus(),this.scrollToBottom(),Promise.resolve()}enterText(){const t=this.inputOutput();t.length>0&&(this.userInput(t),this.setText(""))}inputOutput(t){t=!1!==t;const e=this.input.textContent||"";return e.length>0&&this.output(e,0,t),e}specialUserInput(t,e){this.userInput("§§§"+t+"§§§"+e)}userInput(t){null!==this.processManager&&this.processManager.stdIn("user",t)}tabKey(){this.specialUserInput("tab",this.input.textContent||"")}}},function(t,e,s){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e.default=t,e},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(s(0)),n=r(s(1)),a=r(s(4)),l=r(s(2)),h=s(9),c=new n.default("root",[],"/"),u=new n.default("guest",[],"/home/guest"),p=(()=>{try{return window.self!==window.top}catch(t){return!0}})();o.createRoot(c),o.default.mkdir("/bin",c),o.default.mkdir("/home",c),o.default.mkdir("/home/guest",c).then(()=>{o.default.chown("/home/guest",c,"guest","guest").then(()=>{o.default.mkdir("/home/guest/bin",u),o.default.write("/home/guest/test","Lorem ipsum dolor sit amet, consectetur \n\n\n\n\n\n\n adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",u),o.default.mkdir("/home/guest/bin",u)})}),o.default.mkdir("/home/root",c),Object.entries(h.DefaultApps).map(t=>{o.default.write("bin/"+t[0],t[1].toString(),c),o.default.chmod("bin/"+t[0],c,"755")});const d=new l.default,f=new a.default;document.addEventListener("DOMContentLoaded",()=>{console.log(location.host,p),d.init(f),f.init(d),d.output([["Welcome to wlf.io TSPseudoOS v0.1 LTNS(Little To No Support)"],[""],["  * Try the command help to see what you can do"],[""],["Last Login: Fri, 25 Oct 2019 18: 57: 47 GMT"]],0,!0),f.startProcess("bash",[],u)})},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(0)),o=i(s(1)),n=s(2),a=i(s(5));e.default=class{constructor(){this.display=null,this.processes={},this.pids=0,this.pending=[],this.libJS=null,this.mainProcess=null}setEnv(t,e,s){return this.processes.hasOwnProperty(t)?(this.processes[t].setEnv(e,s),Promise.resolve()):Promise.reject()}init(t){this.display=t}killProcess(t){const e=this.getProcessFromID(t);null!==e&&e.kill()}stdIn(t,e){null!==this.mainProcess?this.mainProcess.stdIn(t,e):console.log("STDIN",e)}endProcess(t){this.processes.hasOwnProperty(t)&&delete this.processes[t]}async startProcess(t,e,s,i){if(s instanceof o.default||i instanceof a.default&&(s=i.getIdentity()),!(s instanceof o.default))throw new Error("Identity is not identity");e=e.filter(t=>t.length>0);try{const o=await r.default.execRead(t,s);this.pids++;const n=o[0],l=o[1].trim(),h=new a.default(this,n,this.pids,e,s,i);return h.start(l),this.processes[this.pids]=h,null===this.mainProcess&&(this.mainProcess=h),h}catch(t){return console.log(["Process Error",t]),Promise.reject(["Process Error",t])}}getProcessFromID(t){return Object.values(this.processes).find(e=>e.id===t)||null}getDisplay(){return null!==this.display?this.display:new n.StubDisplay}}},function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const FileSystem_1=__importDefault(__webpack_require__(0)),Identity_1=__importDefault(__webpack_require__(1)),OSLib_1=__importDefault(__webpack_require__(6));class Process{constructor(t,e,s,i,r,o){if(this.code="",this.dead=!1,this.children=[],this.parentInCB=null,this.parentEndCB=null,this.parentID=-1,this.api={Std:{out:t=>this.hasParent()?this.intoParent(t):this.api.Display.print({data:t,over:0}),in:t=>this.intoChild(t.pid,t.data,t.source||null)},FS:{list:t=>FileSystem_1.default.list(t,this),mkdir:t=>FileSystem_1.default.mkdir(t,this),resolve:t=>FileSystem_1.default.resolveWorkingPaths(t,this),append:t=>FileSystem_1.default.append(t.path,t.content,this),write:t=>FileSystem_1.default.write(t.path,t.content,this),touch:t=>FileSystem_1.default.touch(t,this),read:t=>FileSystem_1.default.read(t,this),del:t=>FileSystem_1.default.del(t,this),dirExists:t=>FileSystem_1.default.dirExists(t,this),fileExists:t=>FileSystem_1.default.fileExists(t,this),delDir:t=>FileSystem_1.default.delDir(t,this)},Process:{end:()=>this.kill(),setEnv:t=>this.setEnv(t.prop,t.value,t.pid),self:()=>Promise.resolve(this.data()),start:t=>this.manager.startProcess(t.exec,t.params,null,this),crash:t=>(this.api.Std.out(t),this.kill()),changeWorkingPath:t=>this.changeWorkingPath(t.path,t.pid)},Display:{prompt:t=>this.manager.getDisplay().setText(t),print:t=>this.manager.getDisplay().output(t.data,t.over,!1),printLn:t=>this.manager.getDisplay().output(t.data,t.over,!0),info:()=>this.manager.getDisplay().info()}},this.manager=t,this.exec=e,this.id=s,this.lib=new OSLib_1.default((t,e)=>this.call(t,e)),this.identity=r.getIdentity(),this.params=i,o instanceof Process){this.parentID=o.id;const t=o.registerChild(this);this.parentInCB=t[0],this.parentEndCB=t[1]}}getIdentity(){return this.identity instanceof Identity_1.default?this.identity.getIdentity():this.identity}setEnv(t,e,s){if("number"==typeof s)return s===this.parentID||this.children.hasOwnProperty(s)?this.manager.setEnv(s,t,e):Promise.reject();switch(t){case"log":console.log("Process SET",e);break;case"workingPath":case"workingDir":this.changeWorkingPath(e);break;default:this.identity.setEnv(t,e)}return this.event(["Process","self"],this.data()),Promise.resolve()}start(code){this.code=code;const wrapper=["((proc,osLib)=>{\n",this.code,";\nreturn new Main(proc,osLib);\n})"].join("");return this.app=eval(wrapper)(this.data(),this.lib),!0}hasParent(){return this.parentID>=0}intoParent(t){return null!==this.parentInCB?(this.parentInCB(t),Promise.resolve()):Promise.reject()}call(t,e){return this.api.hasOwnProperty(t.service)&&this.api[t.service].hasOwnProperty(t.func)?this.api[t.service][t.func](e):Promise.reject(new Error(["PM Error","Atempt to access non-existant System Call\n"+t.service+">"+t.func,this.exec+"["+this.id+"]"].join(" : ")))}data(){return{id:this.id,exec:this.exec,params:[...this.params],identity:this.identity,dead:this.dead,parentID:this.parentID}}registerChild(t){return this.children[t.id]=t,[e=>{this.stdIn(t.id,e)},()=>{this.removeChild(t)}]}removeChild(t){this.event(["Process","end"],t.id),delete this.children[t.id]}intoChild(t,e,s){return this.children.hasOwnProperty(t)?this.children[t].stdIn(e,s):Promise.reject()}stdIn(t,e){return this.event(["Std","in"],{from:t,data:e})}async changeWorkingPath(t,e){"number"==typeof e&&e>0?this.manager.setEnv(e,"workingPath",t):this.identity.changeWorkingPath(t)}event(t,e){return this.lib.fireEvent({service:t[0],func:t[1]},e)}kill(){return this.dead=!0,delete this.app,delete this.lib,null!==this.parentEndCB&&this.parentEndCB(),this.manager.endProcess(this.id),Promise.resolve()}}exports.default=Process},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(7)),o=i(s(8));e.default=class{constructor(t){this.hooks={},this.awaitProcs={},this.Std={event:{in:t=>this.hookEvent("Std","in",t)},out:t=>this.call("Std","out",t),in:(t,e,s)=>this.call("Std","in",{pid:t,data:e,source:s})},this.FS={list:t=>this.call("FS","list",t),mkdir:t=>this.call("FS","mkdir",t),resolve:t=>this.call("FS","resolve",t),append:(t,e)=>this.call("FS","append",{path:t,content:e}),write:(t,e)=>this.call("FS","write",{path:t,content:e}),touch:t=>this.call("FS","touch",t),read:t=>this.call("FS","read",t),del:t=>this.call("FS","del",t),dirExists:t=>this.call("FS","dirExists",t),fileExists:t=>this.call("FS","fileExists",t),delDir:t=>this.call("FS","delDir",t)},this.Process={event:{start:t=>this.hookEvent("Process","start",t),msg:t=>this.hookEvent("Process","msg",t),end:t=>this.hookEvent("Process","end",t),self:t=>this.hookEvent("Process","self",t)},end:()=>this.call("Process","end"),self:()=>this.call("Process","self"),start:(t,e)=>this.call("Process","start",{exec:t,params:e}),crash:t=>this.call("Process","crash",t),changeWorkingPath:(t,e)=>this.call("Process","changeWorkingPath",{path:t,pid:e}),msg:(t,e)=>this.call("Process","msg",{pid:t,msg:e}),kill:t=>this.call("Process","kill",t),list:()=>this.call("Process","list"),startAndAwaitOutput:(t,e)=>this.startAndAwait(t,e)},this.Display={prompt:t=>this.call("Display","prompt",t),printRaw:(t,e,s)=>this.call("Display","print",{data:t,over:e||0,newLine:!0===s}),print:(t,e)=>this.Display.printRaw(t,e,!1),printLn:(t,e)=>this.Display.printRaw(t,e,!0),info:()=>this.call("Display","info")},this.Util=r.default,this.CMD=o.default,this._call=t}call(t,e,s){return this._call({service:t,func:e},s)}hookEvent(t,e,s){const i=t+":"+e;this.hooks[i]=s}startAndAwait(t,e){return new Promise((s,i)=>{this.Process.start(t,e).then(t=>{this.awaitProcs[t.id]={resolve:s,reject:i}}).catch(t=>i(t))})}fireEvent(t,e){return this.fireHooks(t,e)}awaitIn(t){return!("number"!=typeof t.from||!this.awaitProcs.hasOwnProperty(t.from))&&(this.awaitProcs[t.from].resolve(t),delete this.awaitProcs[t.from],!0)}fireHooks(t,e){const s=t.service+":"+t.func;return"Std:in"===s&&this.awaitIn(e)?Promise.resolve():this.hooks.hasOwnProperty(s)?this.hooks[s](e):Promise.reject("MISSING")}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Util={loadArgs:(t,e,s)=>{let i=[];for(let r=0;r<t.length;r++){let o=t[r];if(o.startsWith("--")&&o.length>2){if(o=o.slice(2),!e.hasOwnProperty(o))return Promise.reject(new Error(["Load Args Error","unrecognized option '--"+o+"'\nTry '--help' for more information.",JSON.stringify(t)].join(" : ")));r<t.length-1&&!t[r+1].startsWith("-")&&"boolean"!=typeof e[o]?(r++,e[o]=t[r]):e[o]=!e[o]}else if(o.startsWith("-")&&o.length>1&&"--"!==o){o=o.slice(1);for(let t=0;t<o.length;t++){const i=o.charAt(t);s.hasOwnProperty(i)&&(e[s[i]]=!e[s[i]])}}else i=[...i,o]}return Promise.resolve(i)},bytesToHuman:(t,e,s)=>{(s=!0===s)&&(t*=8);const i=(e=!0===e)?1e3:1024,r=s?e?["b","kb","mb","gb","pb"]:["b","Kb","Mb","Gb","Pb"]:e?["B","kB","mB","gB","pB"]:["B","KB","MB","GB","PB"];let o=0;for(;t>i;)t/=i,o++;return Math.round(t)+r[o]}},e.default=e.Util},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=(t,e)=>{if(!(t=>{return/[0-9A-F]{3}/g.test(t)})(t))throw new Error(["CMD Error",e,"Must be 3 hex chars"].join(" : "))},r={Colours:{red:"F00",green:"0F0",blue:"23F",black:"000",white:"FFF",lightBlue:"38F"},Colourize:(t,e,s)=>(s=(s=s||"000").toUpperCase(),e=e.toUpperCase(),i(e),i(s),"§"+e+s+t)};e.default=r},function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s(10)),o=i(s(11)),n=i(s(12)),a=i(s(13)),l=i(s(14)),h=i(s(15)),c=i(s(16)),u=i(s(17)),p=i(s(18)),d=i(s(19));e.DefaultApps={ls:r.default,bash:o.default,mkdir:n.default,cat:a.default,touch:l.default,rm:h.default,cd:c.default,tail:u.default,head:p.default,edit:d.default}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.opts={all:!1,human:!1,long:!1,"no-group":!1,raw:!1},this.count=0,this.done=0,this.argMap={a:"all",h:"human",l:"long",G:"no-group"},this.process=t,this.api=e,this.start(t.params)}async start(t){try{let e=await this.api.Util.loadArgs(t,this.opts,this.argMap);this.count=e.length,this.count<1&&(e=[""],this.count=1),e.map(t=>this.list(t))}catch(t){this.error(t)}}formatFileName(t){let e=t.name;if(this.opts.raw)return e;e.indexOf(" ")>=0&&(e="'"+e+"'");let s=this.api.CMD.Colours.white,i=this.api.CMD.Colours.black;return t.file||(s=this.api.CMD.Colours.blue),this.api.CMD.Colourize(e,s,i)}longOutputEntry(t){const e={perms:t.perms,user:t.user,group:t.group,size:t.size,name:this.formatFileName(t)};return this.opts["no-group"]&&delete e.group,Object.values(e)}longOutput(t,e){let s=[t,["perms\t","user",this.opts["no-group"]?"":"group","size","name"].filter(t=>t.length>0)];return e.map(t=>this.longOutputEntry(t)).map(t=>s.push(t)),s}shortOutput(t){return t.map(t=>this.formatFileName(t))}output(t,e){let s;this.opts.all||(e=e.filter(t=>!t.name.startsWith("."))),this.opts.human,s=this.opts.long?this.longOutput(t,e):this.shortOutput(e),this.api.Std.out(s),this.done++,this.done>=this.count&&this.api.Process.end()}error(t){this.api.Process.crash(t)}async list(t){try{const e=await this.api.FS.list(t);this.output(t,e)}catch(t){console.log("bob",t),this.error(t)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.bashHistoryFile="~/.bash_history",this.host=window.location.origin.split("://")[1].split(":")[0]||"[MISSING HOST]",this.activeProcessID=-1,this.activeOutputed=!1,this.subProcs={},this.history=[],this.historyPosition=0,this.bashProcess=t,this.api=e,this.api.Process.event.self(t=>this.selfUpdate(t)),this.api.Process.event.end(t=>this.end(t)),this.api.Std.event.in(t=>this.stdIn(t)),this.start()}setHistoryPosition(t){this.historyPosition=Math.min(Math.max(t,0),history.length)}showHistory(t){this.setHistoryPosition(t),this.api.Display.prompt(this.history[this.history.length-this.historyPosition])}newHistory(t){t.length>0&&t!==this.history[this.history.length-1]&&(this.history.push(t),this.api.FS.append(this.bashHistoryFile,t+"\n")),this.historyPosition=0}getSubProc(t){return this.subProcs.hasOwnProperty(t)?this.subProcs[t]:null}printPrompt(t){t=!0===t,this.api.Std.out((t?"\n":"")+this.api.CMD.Colourize(this.bashProcess.identity.user+"@"+this.host,this.api.CMD.Colours.green)+this.api.CMD.Colourize(":",this.api.CMD.Colours.white)+this.api.CMD.Colourize(this.bashProcess.identity.workingDir.replace("/home/"+this.bashProcess.identity.user,"~"),this.api.CMD.Colours.blue)+this.api.CMD.Colourize("$ ",this.api.CMD.Colours.white))}splitUserInput(t){return(t.match(/(".*?"|[^" \s]+)(?=\s* |\s*$)/g)||[]).map(t=>('"'===(t=t.trim()).charAt(0)&&'"'===t.charAt(t.length-1)&&(t=t.slice(1,t.length-1)),t))}start(){this.api.FS.read(this.bashHistoryFile).then(t=>{this.history=t.split("\n").filter(t=>t.length>0).filter((t,e,s)=>e>0&&s[e-1]!==t)}),this.printPrompt()}resolveAppIn(t){const e=this.getSubProc(parseInt(t.from));let s=t.data;return t.data instanceof Array&&null!==e&&"ERROR"===t.data[0]&&(s=e.exec.split("/").pop()+": "+t.data[2]),parseInt(t.from,10)===this.activeProcessID&&(this.activeOutputed=!0),this.api.Std.out(s),Promise.resolve("asd")}ctrlCode(t){switch(t){case"c":this.api.Std.out("^C"),this.printPrompt(!0),this.api.Display.prompt("")}}async tabComplete(t){const e=this.splitUserInput(t);let s=null;if(1===e.length);else{const t=e[e.length-1].split("/"),i=t.slice(0,t.length-1).join("/"),r=t[t.length-1],o=["--raw"];r.startsWith(".")&&o.push("--all"),o.push(i);const n=(await this.api.Process.startAndAwaitOutput("ls",o)).data,a=n.filter(t=>t.startsWith(r));if(1===a.length){t[t.length-1]=a[0];const s=t.join("/"),i=await this.api.FS.dirExists(s);e[e.length-1]=s+(i?"/":"")}else s=n}null!==s&&(this.api.Std.out(t+"\n"),this.api.Std.out(s),this.printPrompt(!0)),this.api.Display.prompt(e.map(t=>t.indexOf(" ")>=0?'"'+t+'"':t).join(" "))}specialCode(t){const e=t.split("§§§").filter(t=>t.length>0);switch(e[0].toLowerCase()){case"ctrl":this.ctrlCode(e[1]);break;case"dir":this.showHistory(parseInt(e[1],10)+this.historyPosition);break;case"tab":this.tabComplete(e[1]);break;default:console.log("SPECIAL CODE",e)}}selfUpdate(t){return this.bashProcess=t,Promise.resolve()}async stdIn(t){if("user"===t.from){if("string"==typeof t.data)if(t.data.startsWith("§§§"))this.specialCode(t.data);else{if(this.activeProcessID>0)return void this.api.Std.in(this.activeProcessID,t.data,t.from);if("exit"===t.data)return void this.api.Process.end();const e=this.splitUserInput(t.data),s=e.shift()||"";try{const t=await this.api.Process.start(s,e);this.activeOutputed=!1,this.subProcs[t.id]=t,this.activeProcessID=t.id}catch(t){console.log("EXEC ERROR",t);try{"FS Error"===t[1]&&"Not found"===t[3]?this.api.Std.out(s+": command not found"):this.api.Std.out(t[1])}catch(t){this.api.Std.out(["BASH LAUNCH ERROR",t.message])}this.printPrompt(!0)}this.newHistory(t.data)}}else{const e=await this.resolveAppIn(t);"string"!=typeof e&&console.log(e)}}end(t){return null!==this.getSubProc(t)&&(delete this.subProcs[t],t===this.activeProcessID&&(this.activeProcessID=-1,this.printPrompt(this.activeOutputed))),Promise.resolve()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.help=[["Usage: mkdir[OPTION]...DIRECTORY..."],["Create the DIRECTORY(ies), if they do not already exist."],[""],["Mandatory arguments to long options are mandatory for short options too."],["  - p, --parents","no error if existing, make parent directories as needed"],["  - v, --verbose","print a message for each created directory"],["  ","--help","","display this help and exit"],["  ","--version","output version information and exit"]],this.version=["mkdir (GNU coreutils) 0.1","Copyright(C) 2010 wlf.io.","License MIT License < https://raw.githubusercontent.com/wlfio/TSPseudoOS/master/LICENSE >.","This is free software: you are free to change and redistribute it.","There is NO WARRANTY, to the extent permitted by law.","","Written by wlf.io."].join("\n"),this.options={help:!1,version:!1,verbose:!1,parents:!1},this.optMap={"?":"help",v:"verbose",p:"parents"},this.count=0,this.OS=e,this.start(t.params)}error(t){t instanceof Array&&"Path is not directory"===t[2]&&(t=new Error("MKDIR ERROR : no such file or directory '"+t[3]+"' : "+t.join(" : "))),this.OS.Process.crash(t)}breakPathIntoParentPaths(t){return t.split("/").filter(t=>t.length>0).reduce((t,e,s)=>(e=0===s?"/"+e:t[t.length-1]+"/"+e,t.push(e),t),[])}breakPathsIntoParentPaths(t){return t.map(t=>this.options.parents?this.breakPathIntoParentPaths(t):[t])}async make(t){let e="";try{const s=await this.OS.FS.resolve(t);console.log("PATHS",s);const i=this.breakPathsIntoParentPaths(s);console.log("BROKEN",i);for(let t=0;t<i.length;t++){const s=i[t];for(let t=0;t<s.length;t++){const i=s[t],r=await this.OS.FS.mkdir(i);console.log("PATH DONE",i,r),this.options.verbose&&r&&this.OS.Std.out(e+"created directory '"+s[this.count]+"'"),r||this.options.parents||this.OS.Std.out(e+"cannot create directory '"+s[this.count]+"': File exists"),e="\n"}}this.OS.Process.end()}catch(t){console.log("ERROROR",t),this.error(t)}}async start(t){const e=await this.OS.Util.loadArgs(t,this.options,this.optMap);e.length<1&&!this.options.help&&!this.options.version?this.OS.Process.crash(new Error(["mkdir error","missing operand\nTry 'mkdir --help' for more information",JSON.stringify(t)].join(" : "))):this.options.help?this.OS.Std.out(this.help):this.options.version?this.OS.Std.out(this.version):this.make(e)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.options={number:!1,"squeeze-blank":!1},this.optMap={n:"number",s:"squeeze-blank"},this.count=0,this.OS=e,this.start(t.params)}error(t){this.OS.Process.crash(t)}splitLines(t){const e=[];let s=!1;return t.split("\n").forEach(t=>{if(this.count++,t.length<1){if(s)return;s=!0}else s=!1;const i=[];this.options.number&&i.push(this.count.toString()),i.push(t),e.push(i)}),e}output(t){this.OS.Std.out(this.splitLines(t))}async cat(t){try{for(let e=0;e<t.length;e++){const s=await this.OS.FS.read(t[e]);this.output(s)}this.OS.Process.end()}catch(t){this.error(t)}}async start(t){try{const e=await this.OS.Util.loadArgs(t,this.options,this.optMap);if(e.length<1)throw new Error("CAT ERROR : you must include file path(s) : "+JSON.stringify(t));this.cat(e)}catch(t){console.log("CAT ERROR",t),this.error(t)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=(t,e)=>{new class{constructor(t){this.options={verbose:!1},this.optMap={v:"verbose"},this.firstOut=!0,this.loadArgs(t)}async loadArgs(t){try{const s=await e.Util.loadArgs(t,this.options,this.optMap);this.run(s)}catch(t){this.error(t)}}error(t){e.Process.crash(t)}async run(t){for(let s=0;s<t.length;s++){const i=await e.FS.touch(t[s]);this.printOutput(i)}e.Process.end()}printOutput(t){this.options.verbose&&(e.Std.out((this.firstOut?"":"\n")+"created '"+t[0]+"'"),this.firstOut=!1)}}(t.params)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.options={verbose:!1,recursive:!1},this.optMap={v:"verbose",r:"recursive"},this.firstOut=!0,this.OS=e,this.loadArgs(t.params)}async loadArgs(t){try{const e=await this.OS.Util.loadArgs(t,this.options,this.optMap);this.run(e)}catch(t){this.error(t)}}error(t){this.OS.Process.crash(t)}async run(t){try{t=await this.OS.FS.resolve(t);for(let e=0;e<t.length;e++){const s=t[e];let i;await this.OS.FS.dirExists(s)?this.options.recursive?i=await this.OS.FS.delDir(s):this.printDirError(s):i=await this.OS.FS.del(s),this.printOutput(i)}this.OS.Process.end()}catch(t){this.error(t)}}printOutput(t){this.options.verbose&&this.output("deleted '"+t[0]+"'")}printDirError(t){this.output("cannot remove '"+t+"' it's a directory")}output(t){this.OS.Std.out((this.firstOut?"":"\n")+"rm: "+t),this.firstOut=!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t,e){this.options={},this.optMap={},this.firstOut=!0,this.api=e,this.proc=t,this.loadArgs(t.params)}async loadArgs(t){try{const e=await this.api.Util.loadArgs(t,this.options,this.optMap);this.run(e)}catch(t){this.error(t)}}error(t){this.api.Process.crash(t)}async run(t){try{if(this.proc.parentID>0){t=await this.api.FS.resolve(t);const e=await this.api.Process.changeWorkingPath(t[0],this.proc.parentID);console.log("CHANGE DIR",t,e)}this.api.Process.end()}catch(t){this.error(t)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=()=>{new class{constructor(t){this.options={follow:!1},this.optMap={f:"follow"},this.files={},this.loadArgs(t.params)}error(t){OS.Process.crash(t)}async loadArgs(t){const e=await OS.Util.loadArgs(t,this.options,this.options);try{await this.run(e)}catch(t){this.error(t)}console.log(e),OS.Process.end()}async run(t){this.files=await this.readFiles(t),console.log(this.files),this.options.follow||OS.Process.end()}async readFiles(t){const e={};for(let s=0;s<t.length;s++){const i=t[s];e[i]=await OS.FS.read(i)}return e}}(PROCESS)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(t){this.str=t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=class{constructor(){this.bob=1}}}]);
//# sourceMappingURL=os.bundle.js.map